import streamlit as st
import pandas as pd
from datetime import datetime

# ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜
st.title("ğŸ„ é£Ÿå“è¡›ç”Ÿãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¤ã‚º")
st.caption("å…¨10å•ã€‚ã‚ãªãŸã®è¡›ç”ŸçŸ¥è­˜ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ï¼")

# åå‰å…¥åŠ›
user_name = st.text_input("æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", placeholder="ä¾‹ï¼šè¡› ç”Ÿå¤ªéƒ")

# ã‚¯ã‚¤ã‚ºã®ãƒ‡ãƒ¼ã‚¿
questions = [
    {"q": "1. ç´°èŒãŒæœ€ã‚‚å¢—æ®–ã—ã‚„ã™ã„æ¡ä»¶ã¯ï¼Ÿ", "choices": ["ä¹¾ç‡¥ã—ã¦ã„ã‚‹", "ãƒã‚¤ãƒŠã‚¹20â„ƒä»¥ä¸‹", "é«˜æ¸©å¤šæ¹¿", "å¼·é…¸æ€§", "çœŸç©ºçŠ¶æ…‹"], "ans": 2},
    {"q": "2. ãƒãƒ­ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã§æ­£ã—ã„ã‚‚ã®ã¯ï¼Ÿ", "choices": ["ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ¶ˆæ¯’ã ã‘ã§å®Œç’§", "85ã€œ90â„ƒã§90ç§’ä»¥ä¸Šã®åŠ ç†±", "å†·å‡ã™ã‚Œã°æ­»æ»…ã™ã‚‹", "çŸ³é¹¸ã§æ´—ãˆã°ã‚¦ã‚¤ãƒ«ã‚¹ã¯æ­»ã¬", "ä¹¾ç‡¥ã«å¼±ã„"], "ans": 1},
    {"q": "3. è…¸ç®¡å‡ºè¡€æ€§å¤§è…¸èŒï¼ˆO157ç­‰ï¼‰ã®ç‰¹å¾´ã¯ï¼Ÿ", "choices": ["åŠ ç†±ã«éå¸¸ã«å¼·ã„", "æ¯’ç´ ã¯å‡ºã•ãªã„", "å°‘é‡ï¼ˆ10ã€œ100å€‹ï¼‰ã§ã‚‚ç™ºç—‡ã™ã‚‹", "å†¬ã«ã—ã‹ç™ºç”Ÿã—ãªã„", "æµ·æ°´ä¸­ã§ã®ã¿å¢—æ®–ã™ã‚‹"], "ans": 2},
    {"q": "4. æ°´åˆ†æ´»æ€§ã«ã¤ã„ã¦ã€é–“é•ã£ã¦ã„ã‚‹ã‚‚ã®ã€‘ã¯ï¼Ÿ", "choices": ["æ•°å€¤ãŒä½ã„ã»ã©ä¿å­˜æ€§ãŒé«˜ã„", "ç´”æ°´ã¯1.00ã§ã‚ã‚‹", "æ°´åˆ†æ´»æ€§ãŒä½ã„ã»ã©èŒãŒå¢—æ®–ã—ã‚„ã™ã„", "å¡©åˆ†æ¿ƒåº¦ã‚’ä¸Šã’ã‚‹ã¨ä½ä¸‹ã™ã‚‹", "è‡ªç”±æ°´ã®å‰²åˆã‚’ç¤ºã™"], "ans": 2},
    {"q": "5. æ­£ã—ã„æ‰‹æ´—ã„ã®æ‰‹é †ã§æœ€ã‚‚é‡è¦ãªã®ã¯ï¼Ÿ", "choices": ["æ°´ã ã‘ã§æ´—ã†", "æŒ‡å…ˆã‚„çˆªã®é–“ã¾ã§å…¥å¿µã«æ´—ã†", "ãƒãƒ³ã‚«ãƒã§æ‹­ã", "1ç§’ã ã‘çŸ³é¹¸ã‚’ã¤ã‘ã‚‹", "æ‰‹ã®ã²ã‚‰ã ã‘æ´—ã†"], "ans": 1},
    {"q": "6. æ‰‹è¢‹ã‚’äº¤æ›ã™ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ", "choices": ["ç ´ã‚Œã‚‹ã¾ã§ä½¿ã„ç¶šã‘ã‚‹", "1æ—¥1å›ã§è‰¯ã„", "ä½œæ¥­å·¥ç¨‹ãŒå¤‰ã‚ã‚‹ã”ã¨ã«äº¤æ›", "ç´ æ‰‹ã‚ˆã‚Šå®‰å…¨ãªã®ã§äº¤æ›ä¸è¦", "ãƒˆã‚¤ãƒ¬ã«è¡Œãæ™‚ã‚‚ãã®ã¾ã¾ã§è‰¯ã„"], "ans": 2},
    {"q": "7. ç•°ç‰©æ··å…¥é˜²æ­¢ã«åŠ¹æœãŒä½ã„ã‚‚ã®ã¯ï¼Ÿ", "choices": ["ç²˜ç€ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä½¿ç”¨", "ä½œæ¥­å ´ã¸ã®ç§ç‰©æŒã¡è¾¼ã¿", "å¸½å­ã®è€³ã¾ã§è¦†ã†ç€ç”¨", "å‰é«ªã‚’å‡ºã™", "å®šæœŸçš„ãªå‚™å“ç‚¹æ¤œ"], "ans": 3},
    {"q": "8. æ¸…æƒã®åŸºæœ¬ã¨ã—ã¦æ­£ã—ã„ã®ã¯ï¼Ÿ", "choices": ["åºŠãŒæ¿¡ã‚ŒãŸã¾ã¾ã§ã‚‚è‰¯ã„", "è¦‹ãˆãªã„å ´æ‰€ï¼ˆå†·è”µåº«ä¸‹ãªã©ï¼‰ã‚‚è¡Œã†", "é€±ã«1å›ã ã‘æƒãæƒé™¤ã™ã‚‹", "æ´—å‰¤ã¯æ··ãœã¦ä½¿ã†", "æ±šã‚ŒãŒæºœã¾ã£ã¦ã‹ã‚‰è¡Œã†"], "ans": 1},
    {"q": "9. ãƒˆã‚¤ãƒ¬ä½¿ç”¨æ™‚ã®ãƒ«ãƒ¼ãƒ«ã§æ­£ã—ã„ã®ã¯ï¼Ÿ", "choices": ["ä½œæ¥­ç€ã®ã¾ã¾å€‹å®¤ã«å…¥ã‚‹", "å°‚ç”¨ã®å±¥ç‰©ã«å±¥ãæ›¿ãˆã‚‹", "æ‰‹æ´—ã„ã¯é©å½“ã§è‰¯ã„", "ã‚¹ãƒãƒ›ã‚’æŒã¡è¾¼ã‚€", "ãƒ‰ã‚¢ã‚’é–‹ã‘æ”¾ã—ã¦ãŠã"], "ans": 1},
    {"q": "10. ãƒã‚¹ã‚¯ã‚’ç€ç”¨ã™ã‚‹æœ€å¤§ã®ç†ç”±ã¯ï¼Ÿ", "choices": ["é¡”ã‚’éš ã™ãŸã‚", "é˜²å¯’ã®ãŸã‚", "è‡ªåˆ†ã®é£›æ²«ãŒé£Ÿå“ã«é£›ã¶ã®ã‚’é˜²ããŸã‚", "å£°ãŒéŸ¿ã‹ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚", "ç¾©å‹™ã ã‹ã‚‰ä»•æ–¹ãªã"], "ans": 2},
]

# å›ç­”ä¿å­˜ç”¨ãƒªã‚¹ãƒˆ
user_answers = []

# ã‚¯ã‚¤ã‚ºã®è¡¨ç¤º
for i, item in enumerate(questions):
    st.subheader(f"Q{i+1}")
    if i == 4:
        st.info("ğŸ§¼ æ‰‹æ´—ã„ã¯åŸºæœ¬ä¸­ã®åŸºæœ¬ã§ã™ï¼")
    ans = st.radio(item["q"], item["choices"], key=f"q{i}", index=None)
    user_answers.append(item["choices"].index(ans) if ans else -1)

# é€ä¿¡ãƒœã‚¿ãƒ³
if st.button("å›ç­”ã‚’é€ä¿¡ã™ã‚‹"):
    if not user_name:
        st.error("æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    elif -1 in user_answers:
        st.warning("ã™ã¹ã¦ã®å•é¡Œã«å›ç­”ã—ã¦ãã ã•ã„ã€‚")
    else:
        score = sum([10 for i, a in enumerate(user_answers) if a == questions[i]["ans"]])
        st.balloons()
        st.success(f"{user_name}ã•ã‚“ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼")
        st.metric(label="ã‚ãªãŸã®ã‚¹ã‚³ã‚¢", value=f"{score}ç‚¹")

        if score == 100:
            st.write("ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼è¡›ç”Ÿãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼")
        elif score >= 70:
            st.write("ğŸ‘ åˆæ ¼ç‚¹ã§ã™ã€‚å¼•ãç¶šãæ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚")
        else:
            st.write("âš ï¸ ã‚‚ã†ä¸€åº¦å¾©ç¿’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚")

        # ğŸ” ç®¡ç†è€…ç”¨ é›†è¨ˆè¡¨ç¤º
        with st.expander("ğŸ”‘ ç®¡ç†è€…ç”¨ é›†è¨ˆçµæœã‚’è¡¨ç¤º"):
            admin_pw = st.text_input("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type="password")
            if admin_pw == "260218":
                st.success("èªè¨¼ã«æˆåŠŸã—ã¾ã—ãŸï¼")
                # ä»®ã®é›†è¨ˆè¡¨ç¤ºï¼ˆã“ã“ã«Excelã‚„Google Sheetsã®èª­ã¿è¾¼ã¿ã‚’è¿½åŠ å¯èƒ½ï¼‰
                demo_data = pd.DataFrame({
                    "æ°å": [user_name],
                    "ã‚¹ã‚³ã‚¢": [score],
                    "æ—¥æ™‚": [datetime.now().strftime("%Y-%m-%d %H:%M:%S")]
                })
                st.write("### é›†è¨ˆçµæœï¼ˆãƒ‡ãƒ¢ï¼‰")
                st.dataframe(demo_data)
            elif admin_pw:
                st.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚")

